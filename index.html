<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    </style>
</head>
<body class="text-gray-800 antialiased p-4 md:p-8">
    <div class="max-w-7xl mx-auto space-y-6">
        <!-- Header -->
        <header class="flex justify-between items-center bg-white p-6 rounded-xl shadow-sm">
            <h1 class="text-3xl font-bold text-gray-900">Finance Tracker</h1>
            <button onclick="exportData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">Export JSON</button>
        </header>

        <!-- Dashboard Summary -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500">
                <h2 class="text-sm uppercase text-gray-500 font-semibold tracking-wider">Total Income</h2>
                <p id="totalIncome" class="text-3xl font-bold text-green-600 mt-2">$0.00</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-red-500">
                <h2 class="text-sm uppercase text-gray-500 font-semibold tracking-wider">Total Expenses</h2>
                <p id="totalExpenses" class="text-3xl font-bold text-red-600 mt-2">$0.00</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500">
                <h2 class="text-sm uppercase text-gray-500 font-semibold tracking-wider">Balance</h2>
                <p id="balance" class="text-3xl font-bold text-blue-600 mt-2">$0.00</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Forms & Budget -->
            <div class="space-y-6">
                <!-- Add Transaction -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold mb-4">Add Transaction</h2>
                    <form id="transactionForm" class="space-y-4">
                        <input type="hidden" id="transId">
                        <div>
                            <label class="block text-sm font-medium mb-1">Type</label>
                            <select id="transType" class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Amount</label>
                            <input type="number" id="transAmount" step="0.01" required class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Category</label>
                            <select id="transCategory" class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="Salary">Salary</option>
                                <option value="Food">Food</option>
                                <option value="Rent">Rent</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Savings">Savings</option>
                                <option value="Utilities">Utilities</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Date</label>
                            <input type="date" id="transDate" required class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Description</label>
                            <input type="text" id="transDesc" required class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 rounded-lg transition">Save Transaction</button>
                    </form>
                </div>

                <!-- Budget Progress -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold mb-4">Monthly Budget Tracking</h2>
                    <div id="budgetsList" class="space-y-4">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Add Investment -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold mb-4">Add Investment</h2>
                    <form id="investmentForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Name</label>
                            <input type="text" id="invName" required class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Amount</label>
                            <input type="number" id="invAmount" step="0.01" required class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Expected Annual Growth (%)</label>
                            <input type="number" id="invGrowth" step="0.1" required class="w-full border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 rounded-lg transition">Save Investment</button>
                    </form>
                </div>
            </div>

            <!-- Middle & Right Columns -->
            <div class="lg:col-span-2 space-y-6">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm overflow-hidden">
                        <h2 class="text-xl font-bold mb-4">Expenses by Category</h2>
                        <div class="relative h-[250px] w-full">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <h2 class="text-xl font-bold mb-4">Automated Suggestions</h2>
                        <div id="suggestions" class="space-y-3 text-sm text-gray-700">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Transactions List -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                        <h2 class="text-xl font-bold">Transactions</h2>
                        <div class="flex gap-2 w-full sm:w-auto">
                            <input type="date" id="filterDate" class="border p-2 rounded-lg text-sm outline-none w-full sm:w-auto">
                            <select id="filterCategory" class="border p-2 rounded-lg text-sm outline-none w-full sm:w-auto">
                                <option value="">All Categories</option>
                                <option value="Salary">Salary</option>
                                <option value="Food">Food</option>
                                <option value="Rent">Rent</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Savings">Savings</option>
                                <option value="Utilities">Utilities</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="border-b text-gray-500 text-sm uppercase tracking-wider">
                                    <th class="py-3 px-2">Date</th>
                                    <th class="py-3 px-2">Description</th>
                                    <th class="py-3 px-2">Category</th>
                                    <th class="py-3 px-2">Amount</th>
                                    <th class="py-3 px-2 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsList" class="divide-y text-sm">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Investments List -->
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold mb-4">Investments & Growth</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="border-b text-gray-500 text-sm uppercase tracking-wider">
                                    <th class="py-3 px-2">Name</th>
                                    <th class="py-3 px-2">Principal</th>
                                    <th class="py-3 px-2">Growth/Yr</th>
                                    <th class="py-3 px-2">1Yr Est.</th>
                                    <th class="py-3 px-2 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="investmentsList" class="divide-y text-sm">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        // Store all data in browser localStorage so it persists across sessions
        let data = {
            transactions: [],
            investments: []
        };

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('financeTrackerData');
            if (saved) {
                data = JSON.parse(saved);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('financeTrackerData', JSON.stringify(data));
            updateUI();
        }

        // --- Core Functions ---
        
        // Add or Edit Transaction
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('transId').value;
            const type = document.getElementById('transType').value;
            const amount = parseFloat(document.getElementById('transAmount').value);
            const category = document.getElementById('transCategory').value;
            const date = document.getElementById('transDate').value;
            const desc = document.getElementById('transDesc').value;

            if (id) {
                // Edit existing transaction
                const index = data.transactions.findIndex(t => t.id == id);
                if (index > -1) {
                    data.transactions[index] = { id: parseInt(id), type, amount, category, date, description: desc };
                }
            } else {
                // Add new transaction
                data.transactions.push({
                    id: Date.now(),
                    type,
                    amount,
                    category,
                    date,
                    description: desc
                });
            }

            this.reset();
            document.getElementById('transId').value = '';
            document.getElementById('transDate').valueAsDate = new Date();
            saveData();
        });

        // Add Investment
        document.getElementById('investmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('invName').value;
            const amount = parseFloat(document.getElementById('invAmount').value);
            const growthRate = parseFloat(document.getElementById('invGrowth').value);

            data.investments.push({
                id: Date.now(),
                name,
                amount,
                growthRate
            });

            this.reset();
            saveData();
        });

        // Delete Transaction
        function deleteTransaction(id) {
            if(confirm('Are you sure you want to delete this transaction?')) {
                data.transactions = data.transactions.filter(t => t.id !== id);
                saveData();
            }
        }

        // Edit Transaction (populate form)
        function editTransaction(id) {
            const t = data.transactions.find(t => t.id === id);
            if (t) {
                document.getElementById('transId').value = t.id;
                document.getElementById('transType').value = t.type;
                document.getElementById('transAmount').value = t.amount;
                document.getElementById('transCategory').value = t.category;
                document.getElementById('transDate').value = t.date;
                document.getElementById('transDesc').value = t.description;
                window.scrollTo({ top: 0, behavior: 'smooth' }); // scroll to top to see form
            }
        }

        // Delete Investment
        function deleteInvestment(id) {
            if(confirm('Are you sure you want to delete this investment?')) {
                data.investments = data.investments.filter(i => i.id !== id);
                saveData();
            }
        }

        // --- UI Updates ---
        
        let expenseChartInstance = null;

        function updateUI() {
            // Calculate totals
            const income = data.transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = data.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expenses;

            document.getElementById('totalIncome').textContent = '$' + income.toFixed(2);
            document.getElementById('totalExpenses').textContent = '$' + expenses.toFixed(2);
            document.getElementById('balance').textContent = '$' + balance.toFixed(2);
            
            // Render UI components
            renderTransactions();
            renderInvestments();
            renderBudgets();
            renderChart();
            generateSuggestions(income, expenses);
        }

        // Render Transactions List with Filters
        function renderTransactions() {
            const list = document.getElementById('transactionsList');
            const filterDate = document.getElementById('filterDate').value;
            const filterCategory = document.getElementById('filterCategory').value;

            // Filter transactions by date and category
            let filtered = data.transactions;
            
            if (filterDate) {
                filtered = filtered.filter(t => t.date === filterDate);
            }
            if (filterCategory) {
                filtered = filtered.filter(t => t.category === filterCategory);
            }

            // Sort by date desc
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            list.innerHTML = filtered.map(t => `
                <tr class="hover:bg-gray-50 transition">
                    <td class="py-3 px-2 whitespace-nowrap">${t.date}</td>
                    <td class="py-3 px-2">${t.description}</td>
                    <td class="py-3 px-2">
                        <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">${t.category}</span>
                    </td>
                    <td class="py-3 px-2 font-medium ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                        ${t.type === 'income' ? '+' : '-'}$${t.amount.toFixed(2)}
                    </td>
                    <td class="py-3 px-2 text-right whitespace-nowrap">
                        <button onclick="editTransaction(${t.id})" class="text-blue-500 hover:underline mr-2">Edit</button>
                        <button onclick="deleteTransaction(${t.id})" class="text-red-500 hover:underline">Del</button>
                    </td>
                </tr>
            `).join('');
            
            if(filtered.length === 0) {
                list.innerHTML = `<tr><td colspan="5" class="py-4 text-center text-gray-500">No transactions found.</td></tr>`;
            }
        }

        // Render Budgets Progress
        function renderBudgets() {
            const container = document.getElementById('budgetsList');
            const expenses = data.transactions.filter(t => t.type === 'expense');
            const categoryTotals = {};
            
            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });

            // Default suggested monthly budgets
            const defaultBudgets = {
                Food: 600,
                Rent: 1500,
                Entertainment: 200,
                Utilities: 300,
                Other: 300
            };

            const html = Object.keys(defaultBudgets).map(cat => {
                const spent = categoryTotals[cat] || 0;
                const budget = defaultBudgets[cat];
                const percent = Math.min((spent / budget) * 100, 100);
                let colorClass = 'bg-green-500';
                if (percent > 80) colorClass = 'bg-yellow-500';
                if (percent >= 100) colorClass = 'bg-red-500';

                return `
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="font-medium">${cat}</span>
                            <span class="text-gray-600">$${spent.toFixed(2)} / $${budget}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="${colorClass} h-2.5 rounded-full" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // Render Investments List
        function renderInvestments() {
            const list = document.getElementById('investmentsList');
            
            list.innerHTML = data.investments.map(inv => {
                // Show growth over time (1 Year Estimated)
                const est1Yr = inv.amount * (1 + (inv.growthRate / 100));
                return `
                <tr class="hover:bg-gray-50 transition">
                    <td class="py-3 px-2 font-medium">${inv.name}</td>
                    <td class="py-3 px-2">$${inv.amount.toFixed(2)}</td>
                    <td class="py-3 px-2 text-green-600">+${inv.growthRate}%</td>
                    <td class="py-3 px-2 text-indigo-600 font-medium">$${est1Yr.toFixed(2)}</td>
                    <td class="py-3 px-2 text-right whitespace-nowrap">
                        <button onclick="deleteInvestment(${inv.id})" class="text-red-500 hover:underline">Del</button>
                    </td>
                </tr>
                `;
            }).join('');

            if(data.investments.length === 0) {
                list.innerHTML = `<tr><td colspan="5" class="py-4 text-center text-gray-500">No investments added.</td></tr>`;
            }
        }

        // Render Expense Chart
        function renderChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            const expenses = data.transactions.filter(t => t.type === 'expense');
            const categoryTotals = {};
            
            expenses.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });

            const labels = Object.keys(categoryTotals);
            const values = Object.values(categoryTotals);

            if (expenseChartInstance) {
                expenseChartInstance.destroy();
            }

            expenseChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.length > 0 ? labels : ['No Data'],
                    datasets: [{
                        data: values.length > 0 ? values : [1],
                        backgroundColor: values.length > 0 ? [
                            '#ef4444', '#f97316', '#f59e0b', '#84cc16', 
                            '#22c55e', '#06b6d4', '#3b82f6', '#8b5cf6', '#d946ef'
                        ] : ['#e5e7eb'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: 10
                    },
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // Generate Automated Savings Suggestions based on income and expenses
        function generateSuggestions(income, expenses) {
            const container = document.getElementById('suggestions');
            let suggestions = [];

            if (income === 0 && expenses === 0) {
                suggestions.push("Add your income and expenses to get personalized suggestions.");
            } else {
                const savingsRate = income > 0 ? ((income - expenses) / income) * 100 : 0;
                
                if (savingsRate >= 20) {
                    suggestions.push("<div class='p-3 bg-green-50 rounded border border-green-200 text-green-800'>üåü Great job! You are saving <strong>" + savingsRate.toFixed(1) + "%</strong> of your income. Consider investing the surplus.</div>");
                } else if (savingsRate > 0) {
                    suggestions.push("<div class='p-3 bg-blue-50 rounded border border-blue-200 text-blue-800'>üëç You are saving <strong>" + savingsRate.toFixed(1) + "%</strong>. Try to aim for the 50/30/20 rule (50% needs, 30% wants, 20% savings).</div>");
                } else {
                    suggestions.push("<div class='p-3 bg-red-50 rounded border border-red-200 text-red-800'>‚ö†Ô∏è You are spending more than you earn! Review your discretionary expenses like Entertainment and Food.</div>");
                }

                // Analyze high expense categories
                const expenseTxs = data.transactions.filter(t => t.type === 'expense');
                const categoryTotals = {};
                expenseTxs.forEach(t => {
                    categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
                });

                if (categoryTotals['Food'] && categoryTotals['Food'] > income * 0.2 && income > 0) {
                    suggestions.push("<div class='p-3 bg-yellow-50 rounded border border-yellow-200 text-yellow-800'>üí° Your <strong>Food</strong> expenses are high (>20% of income). Consider meal prepping to reduce costs.</div>");
                }
                
                if (categoryTotals['Entertainment'] && categoryTotals['Entertainment'] > income * 0.1 && income > 0) {
                    suggestions.push("<div class='p-3 bg-yellow-50 rounded border border-yellow-200 text-yellow-800'>üí° Your <strong>Entertainment</strong> expenses are over 10% of your income. Look for free local events or reduce subscription services.</div>");
                }
            }

            container.innerHTML = suggestions.join('');
        }

        // Simple file-save mechanism (download JSON of all data)
        function exportData() {
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'finance-tracker-backup.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- Event Listeners for Filters ---
        document.getElementById('filterDate').addEventListener('change', renderTransactions);
        document.getElementById('filterCategory').addEventListener('change', renderTransactions);

        // --- Initialization ---
        document.getElementById('transDate').valueAsDate = new Date();
        loadData();
        updateUI();

    </script>
</body>
</html>
